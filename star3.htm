<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>［419特刊］你不可不知的床上运动18招</title>
    <link type="text/css" rel="stylesheet" href="css/animate.css" />
    <link type="text/css" rel="stylesheet" href="css/star2.css" />
    <script type='text/javascript' charset='utf8' src="js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" charset="utf8" src="js/jquery.touchwipe.js"></script>
    <script type="text/javascript" charset="utf8" src="js/jquery.bgmusic.js"></script>
    <script type="text/javascript" src="js/html2canvas.js"></script>
    <style>
        .d-share
        {
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
            position: absolute;
            overflow: hidden;
            background: rgba(0,0,0,.8);
            z-index: 1500;
            display: none;
        }
        #save
        {
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
            position: absolute;
            overflow: hidden;
            z-index: 1501;
            display: none;
            background: url(http://h5.vr.mgtv.com/2016/zmfm/images/tip.png) no-repeat bottom rgba(0,0,0,.8);
            background-size: 100%;
        }
        .d-share img
        {
            width: 100%;
        }
        .diy{width:300px;left:6%;top:6%;position:absolute;}
    </style>
</head>
<body>
    <div id="app">
        <div id="pg0" style="display: block">
            <div id="pg0_1">
            </div>
            <div id="pg0_2">
            </div>
        </div>
        <div id="pg1" style="display: none">
            <div id="pg1_1">
            </div>
            <div id="pg1_2">
            </div>
            <div id="pg1_3">
            </div>
            <div id="pg1_4">
            </div>
            <div id="pg1_5">
            </div>
        </div>
        <div id="pg2" style="display: none">
            <div id="pg2_0" style="display: none;">
            </div>
            <div id="pg2_1" style="display: none; opacity: 0">
                <div id="pg2_1_1" style="display: none">
                </div>
                <div id="pg2_1_2" style="display: none">
                </div>
                <div id="pg2_1_3" style="display: none">
                </div>
            </div>
        </div>
        <div id="pg3" style="display: none">
            <div id="pg3_0" style="display: none;">
            </div>
            <div id="pg3_1" style="display: none; opacity: 0">
                <div id="pg3_1_1" style="display: none">
                </div>
                <div id="pg3_1_2" style="display: none">
                </div>
                <div id="pg3_1_3" style="display: none">
                </div>
            </div>
        </div>
        <div id="pg4" style="display: none">
            <div id="pg4_0" style="display: none;">
            </div>
            <div id="pg4_1" style="display: none; opacity: 0">
                <div id="pg4_1_1" style="display: none">
                </div>
                <div id="pg4_1_2" style="display: none">
                </div>
                <div id="pg4_1_3" style="display: none">
                </div>
            </div>
        </div>
        <div id="pg5" style="display: none">
            <div id="pg5_0" style="display: none;">
            </div>
            <div id="pg5_1" style="display: none; opacity: 0">
                <div id="pg5_1_1" style="display: none">
                </div>
                <div id="pg5_1_2" style="display: none">
                </div>
                <div id="pg5_1_3" style="display: none">
                </div>
            </div>
        </div>
        <div id="pg6" style="display: none">
            <div id="pg6_0" style="display: none;">
            </div>
            <div id="pg6_1" style="display: none; opacity: 0">
                <div id="pg6_1_1" style="display: none">
                </div>
                <div id="pg6_1_2" style="display: none">
                </div>
                <div id="pg6_1_3" style="display: none">
                </div>
            </div>
        </div>
        <div id="pg7" style="display: none">
            <div id="pg7_0" style="display: none;">
            </div>
            <div id="pg7_1" style="display: none; opacity: 0">
                <div id="pg7_1_1" style="display: none">
                </div>
                <div id="pg7_1_2" style="display: none">
                </div>
                <div id="pg7_1_3" style="display: none">
                </div>
            </div>
        </div>
        <div id="pg8" style="display: none">
            <div id="pg8_0" style="display: none;">
            </div>
            <div id="pg8_1" style="display: none; opacity: 0">
                <div id="pg8_1_1" style="display: none">
                </div>
                <div id="pg8_1_2" style="display: none">
                </div>
                <div id="pg8_1_3" style="display: none">
                </div>
            </div>
        </div>
        <div id="pg9" style="display: none">
            <div id="pg9_0" style="display: none;">
            </div>
            <div id="pg9_1" style="display: none; opacity: 0">
                <div id="pg9_1_1" style="display: none">
                </div>
                <div id="pg9_1_2" style="display: none" class="service-icon" onclick="$('.d-share').fadeIn(500);" >
                </div>
                <div id="pg9_1_3" style="display: none">
                </div>
            </div>
        </div>
        <div id="pg10" style="display: none">
            <div id="pg10_0" style="display: none;">
            </div>
            <div id="pg10_1" style="display: none; opacity: 0">
                <div id="pg10_1_1" style="display: none">
                </div>
                <div id="pg10_1_2" style="display: none">
                    <input type="text" class="tb" id="tbname1" maxlength="10" value="请输入名字" />
                </div>
            </div>
        </div>
        <div id="pg11" style="display: none">
            <div id="pg11_0" style="display: none;">
            </div>
            <div id="pg11_1" style="display: none; opacity: 0">
                <div id="pg11_1_1" style="display: none">
                </div>
                <div id="pg11_1_2" style="display: none">
                    <input type="text" class="tb" id="tbname2" maxlength="10" value="请输入名字" />
                </div>
            </div>
        </div>
        <div id="pg12" style="display: none">
            <div id="pg12_0" style="display: none;">
            </div>
            <div id="pg12_1" style="display: none; opacity: 0">
                <div id="pg12_1_1" style="display: none">
                    分享结果
                </div>
                <div id="pg12_1_2" style="display: none">
                    重来一次
                </div>
                <div id="pg12_1_5" style="display: none">
                    下载图片
                </div>
                <div id="pg12_1_3" style="display: none">
                </div>
                <div id="pg12_1_4" style="display: none">
                    <img src="images/qrcode.png" /><br />
                    快来扫码测试
                </div>
            </div>
        </div>
        <div class="sound">
        </div>
        <div class="d-share">
            <img src="images/share.png" class="d-share-hint">
        </div>
        <div id="save" style="z-index: 1600;">
        </div>
    </div>
    <div id="bmg" style="display: none;" class="sound">
    </div>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script type="text/javascript">
        //获取url中的参数
        function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
            var r = window.location.search.substr(1).match(reg);  //匹配目标参数
            if (r != null) return unescape(r[2]); return null; //返回参数值
        }

        function getlocalimg() {
            var lStorage = window.localStorage;
            if (lStorage.draw) {
                var base64 = lStorage.draw;
                //console.log("lStorage:" + lStorage);
                $(".d-share").html("<img src=\"images/share.png\" class=\"d-share-hint\"><img src=\"" + base64 + "\" class=\"diy\" style=\"width:50%;\" >");
            }
        }

        $("#bmg").bgmusic({ 'url': 'http://h5.vr.mgtv.com/2016/zmfm/img2/music.mp3', 'autoplay': true });
        var audio = document.querySelector('audio');
        var sharelink = "http://h5.vr.mgtv.com/2016/zmfm/star2.htm";
        $(document).ready(function () {
            getlocalimg();
            var result = getUrlParam("result");

            console.log("ready:" + result);
            if (result == null) {
                $("#pg3").css("display", "block");
            } else {
                showshareresult(result);
            }
            audio.play();
            $(".sound").css("display", "block");
            /*
            $("#splay").show();
            $("#sclose").hide();
            */
            $("#tbname1").click(function () {
                if ($("#tbname1").val() == "请输入名字") { $("#tbname1").val(""); }
            });
            $("#tbname2").click(function () {
                if ($("#tbname2").val() == "请输入名字") { $("#tbname2").val(""); }
            });

            var title = "［419特刊］你不可不知的床上运动18招",
				link = "http://h5.vr.mgtv.com/2016/zmfm/star2.htm",
				desc = "”特别“的日子送给”特别“的你！",
				img = "http://h5.vr.mgtv.com/2016/zmfm/img2/logo.jpg",
				api = "http://v.api.mgtv.com/weixin/sign";
            $.ajax({
                type: "get",
                async: false,
                url: "http://v.api.mgtv.com/weixin/sign?url=" + encodeURIComponent(location.href.split("#")[0]),
                dataType: "jsonp",
                jsonp: "callback", //传递给请求处理程序或页面的，用以获得jsonp回调函数名的参数名(一般默认为:callback)
                jsonpCallback: "flightHandler", //自定义的jsonp回调函数名称，默认为jQuery自动生成的随机函数名，也可以写"?"，jQuery会自动为你处理数据
                success: function (e) {
                    wx.config({
                        debug: !1,
                        appId: e.data.appId,
                        timestamp: e.data.timestamp,
                        nonceStr: e.data.nonceStr,
                        signature: e.data.signature,
                        jsApiList: ["onMenuShareTimeline", "onMenuShareAppMessage"]
                    }), wx.ready(function (e) {
                        wx.onMenuShareTimeline({
                            title: desc,
                            link: link,
                            imgUrl: img,
                            trigger: function (res) {
                                this.link = sharelink;
                            }
                        }), wx.onMenuShareAppMessage({
                            title: title,
                            desc: desc,
                            link: link,
                            imgUrl: img,
                            trigger: function (res) {
                                this.link = sharelink;
                            }
                        })
                    })
                },
                error: function () {
                    alert('fail');
                }
            });
        });

        function pageinit() {

        }

        $("#pg0").touchwipe({
            wipeUp: function () {
                setTimeout(function () { showquestion(1); }, 500);
            },
            wipeDown: function () {
            },
            min_move_x: 50,
            min_move_y: 50,
            preventDefaultEvents: true
        });
        $("#pg1").touchwipe({
            wipeUp: function () {
                setTimeout(function () {
                    //showquestion(2);
                    document.location = "drawing.html";
                }, 500);
            },
            wipeDown: function () {
            },
            min_move_x: 50,
            min_move_y: 50,
            preventDefaultEvents: false
        });
        $("#pg2").touchwipe({
            wipeUp: function () {
                setTimeout(function () { showquestion(3); }, 500);
            },
            wipeDown: function () {
            },
            min_move_x: 50,
            min_move_y: 50,
            preventDefaultEvents: true
        });
        $("#pg3").touchwipe({
            wipeUp: function () {
                setTimeout(function () { showquestion(4); }, 500);
            },
            wipeDown: function () {
                setTimeout(function () {
                    document.location = "star2.htm";
                }, 500);
            },
            min_move_x: 50,
            min_move_y: 50,
            preventDefaultEvents: true
        });
        $("#pg4").touchwipe({
            wipeUp: function () {
                setTimeout(function () { showquestion(5); }, 500);
            },
            wipeDown: function () {
                setTimeout(function () { showquestion(3); }, 500);
            },
            min_move_x: 50,
            min_move_y: 50,
            preventDefaultEvents: true
        });
        $("#pg5").touchwipe({
            wipeUp: function () {
                setTimeout(function () { showquestion(6); }, 500);
            },
            wipeDown: function () {
                setTimeout(function () { showquestion(4); }, 500);
            },
            min_move_x: 50,
            min_move_y: 50,
            preventDefaultEvents: true
        });

        $("#pg6").touchwipe({
            wipeUp: function () {
                setTimeout(function () { showquestion(7); }, 500);
            },
            wipeDown: function () {
                setTimeout(function () { showquestion(5); }, 500);
            },
            min_move_x: 50,
            min_move_y: 50,
            preventDefaultEvents: true
        });
        $("#pg7").touchwipe({
            wipeUp: function () {
                setTimeout(function () { showquestion(8); }, 500);
            },
            wipeDown: function () {
                setTimeout(function () { showquestion(6); }, 500);
            },
            min_move_x: 50,
            min_move_y: 50,
            preventDefaultEvents: true
        });
        $("#pg8").touchwipe({
            wipeUp: function () {
                setTimeout(function () { showquestion(9); }, 500);
            },
            wipeDown: function () {
                setTimeout(function () { showquestion(7); }, 500);
            },
            min_move_x: 50,
            min_move_y: 50,
            preventDefaultEvents: true
        });
        $("#pg9").touchwipe({
            wipeUp: function () {
                setTimeout(function () {
                    document.location = "star2.htm";
                }, 500);
            },
            wipeDown: function () {
                setTimeout(function () { showquestion(8); }, 500);
            },
            min_move_x: 50,
            min_move_y: 50,
            preventDefaultEvents: true
        });
        $("#pg10").touchwipe({
            wipeUp: function () {
            },
            wipeDown: function () {
            },
            min_move_x: 50,
            min_move_y: 50,
            preventDefaultEvents: true
        });
        $("#pg11").touchwipe({
            wipeUp: function () {
            },
            wipeDown: function () {
            },
            min_move_x: 50,
            min_move_y: 50,
            preventDefaultEvents: true
        });
        $("#pg12").touchwipe({
            wipeUp: function () {
            },
            wipeDown: function () {
            },
            min_move_x: 50,
            min_move_y: 50,
            preventDefaultEvents: true
        });
        var scorearr = [[2, 1, 0], [2, 1, 0], [1, 2, 0], [2, 1, 0], [1, 2, 0], [2, 1, 0], [2, 1, 0], [1, 2, 0]];
        var score = 0;
        function caculatescore(idx, selection) {
            score += scorearr[idx - 2][selection - 1];
            console.log("score:" + score);
        }
        function showquestion(idx) {
            console.log("showquestion:" + idx);
            idx = idx - 1;
            $("#pg" + (idx + 1)).css("display", "block");
            $("#pg" + (idx)).css("display", "none");
            //jiazai2();
            $("#pg" + (idx + 1) + "_1").show().animate({ 'opacity': 1 }, 300, function () {
                $("#pg" + (idx + 1) + "_0").css("display", "block");
                $("#pg" + (idx + 1) + "_0").addClass('jie_animation bounceIn');
                setTimeout(function () {
                    $("#pg" + (idx + 1) + "_0").removeClass('jie_animation bounceIn');

                    $("#pg" + (idx + 1) + "_1_1").fadeIn(500);
                    $("#pg" + (idx + 1) + "_1_2").fadeIn(500);
                    $("#pg" + (idx + 1) + "_1_3").fadeIn(500);
                }, 500);
            });
        }

        function showresult() {
            var idx = 10;
            var myDate = new Date();
            idx += myDate.getSeconds() % 2;
            $("#pg" + idx).css("display", "block");
            $("#pg9").css("display", "none");
            //jiazai2();
            $("#pg" + idx + "_1").show().animate({ 'opacity': 1 }, 300, function () {
                $("#pg" + idx + "_0").css("display", "block");
                $("#pg" + idx + "_0").addClass('jie_animation bounceIn');
                setTimeout(function () {
                    $("#pg" + idx + "_0").removeClass('jie_animation bounceIn');
                    $("#pg" + idx + "_1_1").fadeIn(500, function () { $("#pg" + idx + "_1_1").addClass('service-icon'); });
                    $("#pg" + idx + "_1_2").fadeIn(500);
                }, 500);
            });
        }

        function choose(idx, selection) {
            caculatescore(idx, selection);
            $("#pg" + idx + "_1_" + selection).addClass('jie_animation warn');
            setTimeout(function () {
                $("#pg" + idx + "_1_" + selection).removeClass('jie_animation warn');
                setTimeout(function () { showquestion(idx) }, 150);
            }, 300);
        }
     

      
        $("#save").click(function () { $("#save").fadeOut(500); });


        //分享结果
        $("#pg9_1_2").click(function () {
            $(".d-share").fadeIn(500);
        });



        $(".d-share").click(function () { $(".d-share").fadeOut(500); });
       

        $("#splay").click(function () {
            audio.pause();
            $("#splay").hide();
            $("#sclose").show();
        });

        $("#sclose").click(function () {
            audio.play();
            $("#splay").show();
            $("#sclose").hide();
        });
    </script>
</body>
</html>
